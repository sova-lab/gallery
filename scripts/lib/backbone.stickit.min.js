/*! stecker 2014-06-01 */
!function(a){"function"==typeof define&&define.amd?define(["underscore","backbone","exports"],a):"object"==typeof exports?a(require("underscore"),require("backbone"),exports):a(_,Backbone,{})}(function(a,b,c){c._handlers=[],c.addHandler=function(b){b=a.map(a.flatten([b]),function(b){return a.extend({updateModel:!0,updateView:!0,updateMethod:"text"},b)}),this._handlers=this._handlers.concat(b)},c.ViewMixin={_modelBindings:null,unstickit:function(b,c){if(a.isObject(c))return void a.each(a.keys(c),function(a){this.unstickit(b,a)},this);var d=[],e=[];a.each(this._modelBindings,function(a,f){b&&a.model!==b||c&&a.config.selector!=c||(e.push(a.config._destroy),a.model.off(a.event,a.fn),d.push(a.model),delete this._modelBindings[f])},this),a.invoke(a.uniq(d),"trigger","stickit:unstuck",this.cid),a.each(a.uniq(e),function(a){a.call(this)},this),this._modelBindings=a.compact(this._modelBindings),this.$el.off(".stickit"+(b?"."+b.cid:""),c)},stickit:function(b,c){var d=b||this.model,e=c||a.result(this,"bindings")||{};this._modelBindings||(this._modelBindings=[]),this.addBinding(d,e);var f=this.remove;f.stickitWrapped||(this.remove=function(){var a=this;return this.unstickit(),f&&(a=f.apply(this,arguments)),a}),this.remove.stickitWrapped=!0},addBinding:function(b,c,d){var f,o,p,q,r,s=b||this.model,t=".stickit."+s.cid,u=d||{},v=a.uniqueId();if(!a.isString(c)){var w=c;return void a.each(w,function(a,b){this.addBinding(s,b,w[b])},this)}r=c,f=":el"===r?this.$el:this.$(r),this.unstickit(s,r),f.length&&(a.isString(u)&&(u={observe:u}),a.isFunction(u.observe)&&(u.observe=u.observe.call(this)),q=k(f,u),q.selector=r,p=q.observe,q.bindId=v,q.view=this,o=a.extend({stickitChange:q},q.setOptions),q._destroy=function(){e(this,q.destroy,f,s,q)},l(this,f,q,s,p),m(this,f,q,s,p),p&&(a.each(q.events,function(b){var c=b+t,d=function(b){var c=q.getVal.call(this,f,b,q,a.rest(arguments));g(this,q.updateModel,c,b,q)&&i(s,p,c,o,this,q)};d=a.bind(d,this),":el"===r?this.$el.on(c,d):this.$el.on(c,r,d)},this),a.each(a.flatten([p]),function(a){h(s,this,"change:"+a,q,function(a,b,c){var d=c&&c.stickitChange&&c.stickitChange.bindId||null;d!==v&&n(this,f,q,j(a,p,q,this),a)})},this),n(this,f,q,j(s,p,q,this),s,!0)),e(this,q.initialize,f,s,q))}},a.extend(b.View.prototype,c.ViewMixin);var d=function(b,c){var d=(c||"").split("."),e=a.reduce(d,function(a,b){return a[b]},b);return null==e?b:e},e=function(b,c){return c?(a.isString(c)?d(b,c):c).apply(b,a.rest(arguments,2)):void 0},f=function(a){return a.find("option").not(function(){return!this.selected})},g=function(b,c){return a.isBoolean(c)?c:a.isFunction(c)||a.isString(c)?e.apply(this,arguments):!1},h=function(a,b,c,d,e){a.on(c,e,b),b._modelBindings.push({model:a,event:c,fn:e,config:d})},i=function(b,c,d,f,g,h){var i={};h.onSet&&(d=e(g,h.onSet,d,h)),h.set?e(g,h.set,c,d,f,h):(i[c]=d,a.isArray(c)&&a.isArray(d)&&(i=a.reduce(c,function(b,c,e){return b[c]=a.has(d,e)?d[e]:null,b},{})),b.set(i,f))},j=function(b,c,d,f){var g,h=function(a){return b[d.escape?"escape":"get"](a)},i=function(a){return null==a?"":a};return g=a.isArray(c)?a.map(c,h):h(c),d.onGet&&(g=e(f,d.onGet,g,d)),a.isArray(g)?a.map(g,i):i(g)},k=c.getConfiguration=function(b,d){var e=[{updateModel:!1,updateMethod:"text",update:function(a,b,c,d){a[d.updateMethod]&&a[d.updateMethod](b)},getVal:function(a,b,c){return a[c.updateMethod]()}}];e=e.concat(a.filter(c._handlers,function(a){return b.is(a.selector)})),e.push(d);var f=a.extend.apply(a,e);return f.visible&&!a.has(f,"updateView")?f.updateView=!1:a.has(f,"updateView")||(f.updateView=!0),f},l=function(b,c,d,e,f){var g=["autofocus","autoplay","async","checked","controls","defer","disabled","hidden","indeterminate","loop","multiple","open","readonly","required","scoped","selected"];a.each(d.attributes||[],function(i){var k,l,m="";i=a.clone(i),k=i.observe||(i.observe=f),l=function(){var d=a.indexOf(g,i.name,!0)>-1?"prop":"attr",f=j(e,k,i,b);"class"===i.name?(c.removeClass(m).addClass(f),m=f):c[d](i.name,f)},a.each(a.flatten([k]),function(a){h(e,b,"change:"+a,d,l)}),l()})},m=function(b,c,d,f,g){if(null!=d.visible){var i=function(){var h=d.visible,i=d.visibleFn,k=j(f,g,d,b),l=!!k;(a.isFunction(h)||a.isString(h))&&(l=!!e(b,h,k,d)),i?e(b,i,c,l,d):c.toggle(l)};a.each(a.flatten([g]),function(a){h(f,b,"change:"+a,d,i)}),i()}},n=function(a,b,c,d,f,h){g(a,c.updateView,d,c)&&(e(a,c.update,b,d,f,c),h||e(a,c.afterUpdate,b,d,c))};return c.addHandler([{selector:'[contenteditable="true"]',updateMethod:"html",events:["input","change"]},{selector:"input",events:["propertychange","input","change"],update:function(a,b){a.val(b)},getVal:function(a){return a.val()}},{selector:"textarea",events:["propertychange","input","change"],update:function(a,b){a.val(b)},getVal:function(a){return a.val()}},{selector:'input[type="radio"]',events:["change"],update:function(a,b){a.filter('[value="'+b+'"]').prop("checked",!0)},getVal:function(a){return a.filter(":checked").val()}},{selector:'input[type="checkbox"]',events:["change"],update:function(c,d){if(c.length>1)d||(d=[]),c.each(function(c,e){var f=b.$(e),g=a.indexOf(d,f.val())>-1;f.prop("checked",g)});else{var e=a.isBoolean(d)?d:d===c.val();c.prop("checked",e)}},getVal:function(c){var d;if(c.length>1)d=a.reduce(c,function(a,c){var d=b.$(c);return d.prop("checked")&&a.push(d.val()),a},[]);else{d=c.prop("checked");var e=c.val();"on"!==e&&null!=e&&(d=d?c.val():null)}return d}},{selector:"select",events:["change"],update:function(c,f,g,h){var i,j=h.selectOptions,k=j&&j.collection||void 0,l=c.prop("multiple");if(!j){j={};var m=function(a){return a.map(function(){return{value:this.value,label:this.text}}).get()};c.find("optgroup").length?(k={opt_labels:[]},c.find("> option").length&&(k.opt_labels.push(void 0),a.each(c.find("> option"),function(a){k[void 0]=m(b.$(a))})),a.each(c.find("optgroup"),function(a){var c=b.$(a).attr("label");k.opt_labels.push(c),k[c]=m(b.$(a).find("option"))})):k=m(c.find("option"))}j.valuePath=j.valuePath||"value",j.labelPath=j.labelPath||"label";var n=function(c,e,f){a.each(c,function(c){var g=b.$("<option/>"),h=c,i=function(b,c){g.text(b),h=c,g.data("stickit_bind_val",h),a.isArray(h)||a.isObject(h)||g.val(h)};"__default__"===c?i(j.defaultOption.label,j.defaultOption.value):i(d(c,j.labelPath),d(c,j.valuePath)),!l&&null!=h&&null!=f&&h===f||a.isObject(f)&&a.isEqual(h,f)?g.prop("selected",!0):l&&a.isArray(f)&&a.each(f,function(b){a.isObject(b)&&(b=d(b,j.valuePath)),(b===h||a.isObject(b)&&a.isEqual(h,b))&&g.prop("selected",!0)}),e.append(g)})};c.find("*").remove();var o=function(a,b){var c=window;return 0===b.indexOf("this.")&&(c=a),b=b.replace(/^[a-z]*\.(.+)$/,"$1"),d(c,b)};if(i=a.isString(k)?o(this,k):a.isFunction(k)?e(this,k,c,h):k,i instanceof b.Collection&&(i=i.toJSON()),j.defaultOption&&n(["__default__"],c),a.isArray(i))n(i,c,f);else if(i.opt_labels)a.each(i.opt_labels,function(a){var d=b.$("<optgroup/>").attr("label",a);n(i[a],d,f),c.append(d)});else{var p,q=[];for(var r in i)p={},p[j.valuePath]=r,p[j.labelPath]=i[r],q.push(p);n(a.sortBy(q,j.comparator||j.labelPath),c,f)}},getVal:function(a){var c;return c=a.prop("multiple")?b.$(f(a).map(function(){return b.$(this).data("stickit_bind_val")})).get():f(a).data("stickit_bind_val")}}]),b.Stickit=c,b.Stickit});